<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:composite="http://java.sun.com/jsf/composite">
    
   <composite:interface componentType="net.sf.geojsf.component.Map">
     <composite:attribute name="title"/>
     <composite:attribute name="clientId"/>
     <composite:attribute name="imagePath"/>
     <composite:attribute name="serviceName" default="OpenLayers WMS"/>
     <composite:attribute name="layerOptions" default="{layers: 'basic', format: 'image/png'}"/>
     <composite:attribute name="mapOptions" default=" { controls: [new OpenLayers.Control.MousePosition()] }"/>
     <composite:attribute name="serviceURL" default="http://vmap0.tiles.osgeo.org/wms/vmap0"/>
     <composite:attribute name="centerX" default="0.0"/>
     <composite:attribute name="centerY" default="0.0"/>
     <composite:attribute name="zoomLevel" default="5"/>
     <composite:attribute name="moverview"/>
     <composite:attribute name="moverviewx" default="149"/>
     <composite:attribute name="moverviewy" default="149"/>
     <composite:attribute name="width" default="100%"/>
     <composite:attribute name="height" default="400"/>
     <composite:attribute name="value"/>
     <composite:attribute name="wmsUrl"/>
     <composite:attribute name="layer"/>
     <composite:attribute name="listener" required="true" method-signature="void listener(javax.faces.event.AjaxBehaviorEvent)"/>
     <composite:clientBehavior name="click" 
                              event="click"
                            targets="#{cc.clientId}"/>
   </composite:interface>
        
  <composite:implementation>
   	 <script src="http://openlayers.org/api/OpenLayers.js"/>
   	 <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
   	 <h:outputScript library="geojsf"     name="GeoJSF.js"/>
  <!--   <h:outputScript library="geojsf"     name="scalebar.js"/> --> 
  <!--   <h:outputStylesheet library="geojsf" name="scalebar-thin.css"/> -->   
     <h:outputStylesheet library="geojsf" name="geojsf.css"/>
     <h:outputScript name="jsf.js" library="javax.faces" target="head"/>
     #{cc.fallback()}
     
     <div id="#{cc.clientId}" style="padding: 0; width:#{cc.attrs.width};height:#{cc.attrs.height}px" />
     <c:if test="#{!empty cc.attrs.moverview}">
	 	<div id="#{cc.attrs.moverview}" style="width:#{cc.attrs.moverviewy}px;height:#{cc.attrs.moverviewx}px" />
	 </c:if>
	 
	 	
	 <h:inputText id="coordinates" style="visibility: hidden;">
	    <f:ajax event="change" listener="#{cc.attrs.listener}"/>
	 </h:inputText>
	 
	 
	 
	 <h:outputScript>
        var mloptions = #{cc.attrs.layerOptions};
        var mcoptions = #{cc.attrs.mapOptions};
        var mapDOMelement = $("##{cc.clientId.replaceAll(":","\\\\\\\\:")}");
        var inputDOMelement = $("##{cc.clientId.replaceAll(":","\\\\\\\\:")}\\:coordinates");
        function init()
        {
        	GeoJSF.addClickHandler('#{cc.clientId}','#{cc.clientId}:resetLayers', inputDOMelement, mapDOMelement);
	        GeoJSF.initMap("#{cc.attrs.clientId}",mcoptions);
	        <c:if test="#{!empty initParam['geojsf.THEME']}">
	 			OpenLayers.ImgPath='#{facesContext.externalContext.requestContextPath}/#{initParam['geojsf.THEME']}/';
	 		</c:if>
	 		updateLayers(false);
        }
        GeoJSF.addLoadEvent(init);
     </h:outputScript>
     
     <h:outputScript id="resetLayers">
	 		function updateLayers(reset) {
	 		if (reset) 
	 		{
	 			GeoJSF.resetLayers();
	 		}
	 		<ui:repeat value="#{cc.serviceList}" var="service" varStatus="status">
	 		
	 			
	 		    var url    = "#{service.url}";
	 		    var name   = "#{service.code}";
	 			var params = {};
	 			params.layers      = "#{cc.layerString(service)}";
	 			params.transparent = "true";
	 			params.format      = 'image/png';
	 			var options = {};
	 			options.isBaseLayer= #{status.first};
	 			GeoJSF.addLayer(name, url, params, options);
	 			
	 		</ui:repeat>
     	GeoJSF.center(#{cc.attrs.centerX},#{cc.attrs.centerY},#{cc.attrs.zoomLevel});
	 		};
     </h:outputScript>
  </composite:implementation>
</html>